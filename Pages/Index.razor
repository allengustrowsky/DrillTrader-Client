@page "/"
@using System.ComponentModel.DataAnnotations
@using client.Data

@*Adapted from mublazor components library form example: https://mudblazor.com/components/form#editform-support *@
@if (showLogin)
{
<MudContainer MaxWidth="MaxWidth.Small">
    <EditForm Model="@loginForm" OnValidSubmit="OnValidLogIn" style="margin-top: 70px;">
        <DataAnnotationsValidator />
        <MudCard xs="10" sm="6">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6" xs="10" sm="6">Log in</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTextField Label="Api key" @bind-Value="loginForm.ApiKey" For="@(() => loginForm.ApiKey)" />
            </MudCardContent>
            <MudCardActions>
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Log in</MudButton>
                <MudSpacer />
                <MudButton Variant="Variant.Text" Color="Color.Primary" @onclick="ToggleLoginView">Sign up</MudButton>
            </MudCardActions>
        </MudCard>
    </EditForm>
</MudContainer>
}
else
{
<MudContainer MaxWidth="MaxWidth.Small">
    <EditForm Model="@signUpModel" OnValidSubmit="OnValidSignUp" style="margin-top: 70px;">
        <DataAnnotationsValidator />
        <MudCard xs="10" sm="6">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6" xs="10" sm="6">Sign up</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTextField Label="First Name" @bind-Value="signUpModel.FirstName" For="@(() => signUpModel.FirstName)" />
                <MudTextField Label="Last Name" @bind-Value="signUpModel.LastName" For="@(() => signUpModel.LastName)" />
                <MudTextField Label="Email" @bind-Value="signUpModel.Email" For="@(() => signUpModel.Email)" />
            </MudCardContent>
            <MudCardActions>
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Sign up</MudButton>
                <MudSpacer />
                <MudButton Variant="Variant.Text" Color="Color.Primary" @onclick="ToggleLoginView">Log in</MudButton>
            </MudCardActions>
        </MudCard>
    </EditForm>
</MudContainer>
}


@code {
    private bool showLogin = true;

    // adapted from mudblazor documentation
    private void ToggleLoginView()
    {
        showLogin = !showLogin;
    }

    SignUpForm signUpModel = new SignUpForm();
    bool success;

    public class SignUpForm
    {
        [Required]
        //[StringLength(8, ErrorMessage = "Name length can't be less than 1.")]
        public string FirstName { get; set; }

        [Required]
        public string LastName { get; set; }

        [Required]
        [EmailAddress]
        //[StringLength(30, ErrorMessage = "Password must be at least 8 characters long.", MinimumLength = 8)]
        public string Email { get; set; }
    }

    private void OnValidSignUp(EditContext context)
    {
        success = true;
        StateHasChanged();
    }



    LoginForm loginForm = new LoginForm();

    public class LoginForm
    {
        [Required]
        public string ApiKey { get; set; }
    }

    private void OnValidLogIn(EditContext context)
    {
        success = true;
        StateHasChanged();
    }

}
